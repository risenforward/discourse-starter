<script type="text/discourse-plugin" version="0.8">
  const container = Discourse.__container__;
  const adbutler = settings.main_text
  const { h } = require('virtual-dom');
  const { iconNode } = require("discourse-common/lib/icon-library");
  api.createWidget('adbutler-widget', {
      tagName: 'span',
      html(attrs, state) {
          const path = window.location.pathname;
          let category;
          const controller = container.lookup('controller:navigation/category');
          category = controller.get("category");
          if(/^\/t\//.test(path)) {
              $("body").addClass("adbutler");
              return h('h1', {
                  "attributes" : {
                      "style" : "color: #" + category.color + ";"
                  },
                  innerHTML: adbutler
              });
          } else {
              $("body").removeClass("adbutler");
          }
      }
  }),
  api.decorateWidget('adbutler-widget:after', helper => {
      helper.widget.appEvents.on('page:changed', () => {
          helper.widget.scheduleRerender();
      });
  });
</script>

<script
  type="text/x-handlebars"
  data-template-name="/connectors/below-site-header/adbutler-widget"
>
  {{mount-widget widget="adbutler-widget"}}
</script>